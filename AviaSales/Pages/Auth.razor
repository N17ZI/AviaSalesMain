@page "/SignIn"
@using AviaDB
@using AviaDB.Models
@using AviaSales.Data;
@using AviaSales.Models;
@using Azure
@using DataAccessLibrary
@inject IUserData _db
@inject SingletonServices SingletonServices

<div class="backgroundbodylogin">
    <center class="formlogin">
        <form>
            <h1>Sign In</h1>
            <div class="">
                <input @bind-value="@Login" placeholder="Login" />
                <input placeholder="Password" @bind-value="@Password" />
                <label>By creating an account you agree to our Terms & Privacy.</label>
                <button @onclick="Sign">Sign In</button>
                <label>Dont have account? Create it <a href="#">here</a></label>
            </div>
        </form>

    </center>
</div>


@code {
    string Login = string.Empty;
    string Password = string.Empty;

    List<UserModel> user = new List<UserModel>();

    protected override async Task OnInitializedAsync()
    {
        user = await _db.GetPeople();
        if (Infos.isLoged)
        {
            NavigationManager.NavigateTo("/");
        }
    }

    public void Sign()
    {
        UserVerify();
        if (user.Any(x => x.Login == Login && x.Password == Password))
        {
            Infos.isLoged = true;
        }
    }

    private void UserVerify()
    {
        foreach(var item in user)
        {
            if(item.Login == Login && item.Password == Password)
            {
                Infos.LogedLogin = item.Login;
                string LogedLogin = item.id_user.ToString();
                SingletonServices.SetId(int.Parse(LogedLogin));
            }
        }
    }
}
